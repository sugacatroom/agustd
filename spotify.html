<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SUGA / Agust D Spotify Data</title>
  <link rel="stylesheet" href="style_sptify.css" />
</head>
<body>
  <header>
    <h1>ğŸµ SUGA / Agust D Spotify Data</h1>
    <p class="subtitle">æœ€æ–°ã®Spotifyãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•æ›´æ–°ä¸­</p>
  </header>

  <main>
    <div class="search-container">
      <input type="text" id="search" placeholder="æ›²åã¾ãŸã¯ã‚¢ãƒ«ãƒãƒ ã§æ¤œç´¢..." />
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>æ›²å</th>
            <th>ã‚¢ãƒ«ãƒãƒ </th>
            <th>äººæ°—åº¦</th>
          </tr>
        </thead>
        <tbody id="data-table"></tbody>
      </table>
    </div>
  </main>

  <footer>
    <p>Data provided by Spotify API | æ›´æ–°æ—¥: <span id="updated"></span></p>
  </footer>

  <script>
    const DATA_URL = "spotify_data.json";

    async function loadData() {
      try {
        const res = await fetch(DATA_URL);
        if (!res.ok) throw new Error("JSONã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
        const data = await res.json();
        renderTable(data);
        updateTimestamp();
      } catch (e) {
        console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:", e);
        document.getElementById("data-table").innerHTML =
          `<tr><td colspan="3">âš ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚</td></tr>`;
      }
    }

    function renderTable(data) {
      const tbody = document.getElementById("data-table");
      tbody.innerHTML = "";
      data.forEach(track => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${track.track_name}</td>
          <td class="album">${track.album}</td>
          <td>
            <div class="bar" style="width:${track.popularity || 0}%;"></div>
            <small>${track.popularity ?? "?"}</small>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function updateTimestamp() {
      // GitHub Pagesã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ãŸã‚ã€å¼·åˆ¶çš„ã«æ›´æ–°æ™‚åˆ»ã‚’æ“¬ä¼¼è¡¨ç¤º
      const now = new Date().toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" });
      document.getElementById("updated").textContent = now;
    }

    document.getElementById("search").addEventListener("input", async (e) => {
      const query = e.target.value.toLowerCase();
      const res = await fetch(DATA_URL);
      const data = await res.json();
      const filtered = data.filter(
        t =>
          t.track_name.toLowerCase().includes(query) ||
          t.album.toLowerCase().includes(query)
      );
      renderTable(filtered);
    });

    loadData();
  </script>
</body>
</html>
